<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />

    {% include meta.html %}

<title>{% if page.title %}{{ page.title }} | {{ site.heading }}{% else %}{{ site.heading }}{% endif %}</title>

    {% seo %}
    <!-- PWA Manifest -->
    <link rel="manifest" href="{{ site.baseurl }}/manifest.json" />
    <meta name="theme-color" content="#000000" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Patrick Kyei" />
    <link rel="apple-touch-icon" href="{{ site.baseurl }}/assets/img/patrick.png" />

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css"
        integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous" />

    <!-- Google Fonts-->
    <link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700" rel="stylesheet" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.3/css/bulma.min.css" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" />

    <script src="https://kit.fontawesome.com/28ec8bc467.js" crossorigin="anonymous"></script>
</head>

<body class="has-navbar-fixed-top">
    {{ content }}

    <!-- PWA Install Prompt -->
    <div id="pwa-install-prompt" style="display: none; position: fixed; bottom: 20px; right: 20px; background: #000; color: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 9999; max-width: 300px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
        <div style="margin-bottom: 15px;">
            <strong style="display: block; margin-bottom: 8px;">Install Patrick Kyei</strong>
            <p style="margin: 0; font-size: 14px; opacity: 0.9;">Get faster access to posts and notes on your device</p>
        </div>
        <div style="display: flex; gap: 10px;">
            <button id="pwa-install-btn" style="flex: 1; padding: 10px; background: #fff; color: #000; border: none; border-radius: 4px; font-weight: 600; cursor: pointer;">Install</button>
            <button id="pwa-dismiss-btn" style="flex: 1; padding: 10px; background: rgba(255,255,255,0.2); color: #fff; border: none; border-radius: 4px; cursor: pointer;">Later</button>
        </div>
    </div>

    <script>
        // PWA Install Prompt Handler
        let deferredPrompt;
        const installPrompt = document.getElementById('pwa-install-prompt');
        const installBtn = document.getElementById('pwa-install-btn');
        const dismissBtn = document.getElementById('pwa-dismiss-btn');

        // Check if PWA was already installed or dismissed
        const pwaDismissed = localStorage.getItem('pwa-dismissed');
        const pwaPlatform = /iPad|iPhone|iPod/.test(navigator.userAgent) ? 'ios' : 'other';

        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent the mini-infobar from appearing on mobile
            e.preventDefault();
            deferredPrompt = e;

            // Don't show on iOS since PWA installation is different
            if (pwaPlatform === 'ios') return;

            // Show install prompt if not dismissed
            if (!pwaDismissed) {
                setTimeout(() => {
                    installPrompt.style.display = 'block';
                }, 2000);
            }
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    console.log('PWA installed');
                }
                deferredPrompt = null;
                installPrompt.style.display = 'none';
            }
        });

        dismissBtn.addEventListener('click', () => {
            localStorage.setItem('pwa-dismissed', 'true');
            installPrompt.style.display = 'none';
        });

        // Hide if app is already installed
        window.addEventListener('appinstalled', () => {
            deferredPrompt = null;
            installPrompt.style.display = 'none';
        });
    </script>

    <script>
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker
                .register("{{ site.baseurl }}/service-worker.js")
                .then((reg) => console.log("SW registered:", reg.scope))
                .catch((err) => console.error("SW registration failed:", err));
        }
    </script>
</body>

</html>